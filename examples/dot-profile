# dosh

# Not sh?
if [ "$SHELL" != "/bin/sh" ]; then
	export DOSHELL="$SHELL"
fi

# Export some environment variables
for env in TERM EDITOR; do
	[ -n "$env" ] || continue
	DOSH_DOCKER_RUN_EXTRA_OPTS+=" --env $env"
done

# Map some home dot-files
for vol in $HOME/.config $HOME/.local $HOME/.profile; do
	[ -e "$vol" ] || continue
	DOSH_DOCKER_RUN_EXTRA_OPTS+=" --volume $vol:$vol"
done

# Map bash dot-files
for vol in $HOME/.bash{_profile,rc,login,logout}; do
	[ -e "$vol" ] || continue
	DOSH_DOCKER_RUN_EXTRA_OPTS+=" --volume $vol:$vol"
done

# Map zsh dot-files
zdotdir="${ZDOTDIR:-$HOME}"
for vol in $zdotdir/.zshenv $zdotdir/.zprofile $zdotdir/.zshrc $HOME/.zlogin $HOME/.zlogout; do
	[ -e "$vol" ] || continue
	DOSH_DOCKER_RUN_EXTRA_OPTS+=" --volume $vol:$vol"
done

# Map and export ssh things?
if [ -d "$HOME/.ssh" ]; then
	DOSH_DOCKER_RUN_EXTRA_OPTS+=" --volume $HOME/.ssh:$HOME/.ssh"
fi
if [ -n "$SSH_AUTH_SOCK" ]; then
	DOSH_DOCKER_RUN_EXTRA_OPTS+=" --env SSH_AUTH_SOCK"
	DOSH_DOCKER_RUN_EXTRA_OPTS+=" --volume $SSH_AUTH_SOCK:$SSH_AUTH_SOCK"
fi

export DOSHELL DOSH_DOCKER_RUN_EXTRA_OPTS

# In docker?
[ -z "$DOSHLVL" ] || return

# Update prompt color
PS1="${PS1//32/33}"
PROMPT="${PROMPT//blue/green}"
